name: Arcade actions
on:
  push:
    branches-ignore:
      - ga-ignore-**
env:
  MIRROR_URL:
    git@github.com:EpitechPromo2026/B-OOP-400-REN-4-1-arcade-mael1.becel.git
  EXECUTABLES:
    "arcade"

jobs:
  cleaning:
    name: Cleaning...
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - run: FIND=$(find . -name "#*#" -o -name "*~" -o -name "*.o" -o -name "*.a" -o -name "*.so" -o -name "*.gcno" -o -name "*.gcda" -o -name "*.gcov" -o -wholename "*/tmp/*"); if [[ $FIND != "" ]]; then for element in $FIND; do echo "::error file=$element,line=1,title=Unwanted file detected::$element"; done; exit 1; fi

  compilation:
    name: Compiling...
    needs: cleaning
    runs-on: ubuntu-latest
    container: epitechcontent/epitest-docker
    timeout-minutes: 4
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - run: make
      - run: make clean

  mirroring:
    runs-on: ubuntu-latest
    needs: compilation
    steps:
      - uses: actions/checkout@v2
      - uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          repository: ${{ env.MIRROR_URL }}
          branch: master
          directory: .